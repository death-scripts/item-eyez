<UserControl
    x:Class="Item_eyez.Views.Organize_view"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:Item_eyez.Viewmodels"
    mc:Ignorable="d">
    <UserControl.Resources>
        <LinearGradientBrush x:Key="NodeBackgroundBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Offset="0" Color="#FF69B4" />
            <GradientStop Offset="1" Color="#40E0D0" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="TreeBackgroundBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Offset="0" Color="#20B2AA" />
            <GradientStop Offset="1" Color="#FFDAB9" />
        </LinearGradientBrush>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>
    <UserControl.DataContext>
        <vm:OrganizeViewModel />
    </UserControl.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <GroupBox
            Grid.Row="0"
            Grid.ColumnSpan="2"
            Margin="5"
            Header="search filter">
            <TextBox
                HorizontalAlignment="Stretch"
                Tag="Search"
                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
        </GroupBox>
        <TreeView
            Name="tree"
            Grid.Row="1"
            Grid.Column="0"
            AllowDrop="True"
            Background="{StaticResource TreeBackgroundBrush}"
            DragOver="Tree_DragOver"
            Drop="Tree_Drop"
            ItemsSource="{Binding Roots}"
            PreviewMouseLeftButtonDown="Tree_PreviewMouseLeftButtonDown"
            PreviewMouseRightButtonDown="Tree_LeftClick"
            ScrollViewer.HorizontalScrollBarVisibility="Auto"
            ScrollViewer.VerticalScrollBarVisibility="Auto">
            <TreeView.ContextMenu>
                <ContextMenu>
                    <MenuItem Click="AddItemRoot_Click" Header="Add Item" />
                    <MenuItem Click="AddContainerRoot_Click" Header="Add Container" />
                    <MenuItem Click="AddRoomRoot_Click" Header="Add Room" />
                </ContextMenu>
            </TreeView.ContextMenu>
            <TreeView.Resources>
                <HierarchicalDataTemplate DataType="{x:Type vm:HierarchyNode}" ItemsSource="{Binding Children}">
                    <Border
                        x:Name="nodeBorder"
                        Margin="1"
                        Padding="2"
                        Background="{StaticResource NodeBackgroundBrush}"
                        BorderBrush="Blue"
                        BorderThickness="2"
                        CornerRadius="2">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                Margin="0,0,4,0"
                                MouseMove="DragHandle_MouseMove"
                                PreviewMouseLeftButtonDown="DragHandle_PreviewMouseLeftButtonDown"
                                Text="☰" />
                            <TextBox
                                Background="Transparent"
                                BorderThickness="0"
                                Text="{Binding Name, UpdateSourceTrigger=LostFocus}" />
                        </StackPanel>
                    </Border>
                    <HierarchicalDataTemplate.Triggers>
                        <DataTrigger Binding="{Binding IsMatch}" Value="True">
                            <Setter TargetName="nodeBorder" Property="Background" Value="LightGoldenrodYellow" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                            <Setter TargetName="nodeBorder" Property="Background" Value="AliceBlue" />
                        </DataTrigger>
                    </HierarchicalDataTemplate.Triggers>
                </HierarchicalDataTemplate>
                <Style TargetType="TreeViewItem">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="Visibility" Value="{Binding IsVisible, Converter={StaticResource BoolToVis}}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <EventSetter Event="PreviewMouseLeftButtonDown" Handler="TreeViewItem_PreviewMouseLeftButtonDown" />
                    <EventSetter Event="PreviewMouseRightButtonDown" Handler="TreeViewItem_LeftClick" />
                </Style>
            </TreeView.Resources>
        </TreeView>
        <TreeView
            Name="treeRight"
            Grid.Row="1"
            Grid.Column="1"
            AllowDrop="True"
            Background="{StaticResource TreeBackgroundBrush}"
            DragOver="Tree_DragOver"
            Drop="Tree_Drop"
            ItemsSource="{Binding RightRoots}"
            PreviewMouseLeftButtonDown="Tree_PreviewMouseLeftButtonDown"
            PreviewMouseRightButtonDown="Tree_LeftClick"
            ScrollViewer.HorizontalScrollBarVisibility="Auto"
            ScrollViewer.VerticalScrollBarVisibility="Auto">
            <TreeView.ContextMenu>
                <ContextMenu>
                    <MenuItem Click="AddItemRoot_Click" Header="Add Item" />
                    <MenuItem Click="AddContainerRoot_Click" Header="Add Container" />
                    <MenuItem Click="AddRoomRoot_Click" Header="Add Room" />
                </ContextMenu>
            </TreeView.ContextMenu>
            <TreeView.Resources>
                <HierarchicalDataTemplate DataType="{x:Type vm:HierarchyNode}" ItemsSource="{Binding Children}">
                    <Border
                        x:Name="nodeBorder"
                        Margin="1"
                        Padding="2"
                        Background="{StaticResource NodeBackgroundBrush}"
                        BorderBrush="Blue"
                        BorderThickness="2"
                        CornerRadius="2">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                Margin="0,0,4,0"
                                MouseMove="DragHandle_MouseMove"
                                PreviewMouseLeftButtonDown="DragHandle_PreviewMouseLeftButtonDown"
                                Text="☰" />
                            <TextBox
                                Background="Transparent"
                                BorderThickness="0"
                                Text="{Binding Name, UpdateSourceTrigger=LostFocus}" />
                        </StackPanel>
                    </Border>
                    <HierarchicalDataTemplate.Triggers>
                        <DataTrigger Binding="{Binding IsMatch}" Value="True">
                            <Setter TargetName="nodeBorder" Property="Background" Value="LightGoldenrodYellow" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                            <Setter TargetName="nodeBorder" Property="Background" Value="AliceBlue" />
                        </DataTrigger>
                    </HierarchicalDataTemplate.Triggers>
                </HierarchicalDataTemplate>
                <Style TargetType="TreeViewItem">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="Visibility" Value="{Binding IsVisible, Converter={StaticResource BoolToVis}}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <EventSetter Event="PreviewMouseLeftButtonDown" Handler="TreeViewItem_PreviewMouseLeftButtonDown" />
                    <EventSetter Event="PreviewMouseRightButtonDown" Handler="TreeViewItem_LeftClick" />
                </Style>
            </TreeView.Resources>
        </TreeView>
    </Grid>
</UserControl>